!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.IMUID=t():e.IMUID=t()}(this,(function(){return function(){var e={996:function(e,t){!function(){"use strict";var e={};!function(){var t=e;Object.defineProperty(t,"__esModule",{value:!0}),t.imUlid=void 0;var i="0123456789ABCDEFGHJKMNPQRSTVWXYZ";t.imUlid=function(){for(var e,t=Date.now(),o="",n=10;n--;)o=i[e=t%32]+o,t=(t-e)/32;n=16;var r=new Uint8Array(n);("crypto"in window?crypto:msCrypto).getRandomValues(r);for(;n--;)o+=i[31&r[n]];return o}}();var i=t;for(var o in e)i[o]=e[o];e.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})}()}},t={};function i(o){var n=t[o];if(n!==undefined)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,i),r.exports}i.d=function(e,t){for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var o={};return function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function n(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(o,{IMUID:function(){return E}});var u=i(996);function s(e){for(var t=e+"=",i=t.length,o=document.cookie.split("; "),n=0,r=o.length,u=void 0;n<r;n++)if((u=o[n]).substr(0,i)===t)return u.slice(i);return null}function a(e,t,i){void 0===i&&(i={});var o=i.path,n=i.domain,r=i.maxAge,u=i.expires,s=i.secure,a=i.sameSite,d=e+"="+t;o&&(d+=";path="+o),n&&(d+=";domain="+n),"number"==typeof r&&(d+=";max-age="+r),u&&(d+=";expires="+u.toUTCString()),s&&(d+=";secure"),a&&(d+=";samesite="+a),document.cookie=d}function d(e){return sessionStorage?sessionStorage.getItem(e):null}function c(e,t){try{sessionStorage.setItem(e,t)}catch(i){console.error(i)}}function p(e){sessionStorage&&sessionStorage.removeItem(e)}function f(e,t,i){return void 0===i&&(i={}),function(e,t,i){void 0===i&&(i={});var o=i.onError,n=i.onTimeout,r=i.timeout,u=i.withCredentials,s=new XMLHttpRequest;return s.onload=function(){t(s.responseText)},o&&(s.onerror=function(){o()}),n&&(s.ontimeout=function(){n()}),s.withCredentials=!!u,s.open("GET",e,!0),"number"==typeof r&&(s.timeout=r),s.send(),s}(e,(function(e){t(JSON.parse(e))}),i)}var l="ready",v="loading",m="done",h="expired",y="loadingInBackground",b="none",x="lax",I="optout",k="https",g="timeout",w=".",_="_im_vid",S=function(e){var t=w+location.hostname,i=location.protocol===k;!function(e,t){void 0===t&&(t={}),a(e,"",{maxAge:0,path:t.path,domain:t.domain,secure:t.secure,sameSite:t.sameSite})}(e,{domain:t,path:"/",secure:i,sameSite:i?b:x})},M=function(){function t(){e(this,t),r(this,"processorMap",{})}return n(t,[{key:"run",value:function(e){"customerId"in e&&"callback"in e?this.processIMUIDRequest(e):"optout"in e&&this.processOptoutRequest(e)}},{key:"processIMUIDRequest",value:function(e){var t=e.customerId;t in this.processorMap||(this.processorMap[t]=new U({cid:t})),this.processorMap[t].processIMUIDRequest(e)}},{key:"processOptoutRequest",value:function(e){e.optout?t.vid=I:t.vid===I&&t.reacreateVid()}},{key:"get",value:function(e){var t;return(null===(t=this.processorMap[e])||void 0===t?void 0:t.uid)||""}}],[{key:"vid",get:function(){var e=s(_);return e||(e=(0,u.imUlid)(),t.vid=e),e},set:function(e){e?function(e,t){var i,o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},n=w+location.hostname,r=location.protocol===k,u=o.extendExpireSeconds;u&&(i=new Date).setTime(i.getTime()+1e3*u),a(e,t,{domain:n,path:"/",secure:r,sameSite:r?b:x,expires:i})}(_,e,{extendExpireSeconds:2592e3}):S(_)}},{key:"reacreateVid",value:function(){t.vid=null;var e=t.vid;t.vid=e}},{key:"extendExpireToVid",value:function(){var e=t.vid;t.vid=e}}]),t}(),U=function(){function t(i){e(this,t),r(this,"cid",void 0),this.cid=i.cid}return n(t,[{key:"uidExpireTime",get:function(){var e=d("_im_uid_expire."+this.cid);return"string"==typeof e?parseInt(e||"0"):null},set:function(e){var t="_im_uid_expire."+this.cid;"number"==typeof e?c(t,e+""):p(t)}},{key:"uidLoadStatus",get:function(){var e=d("_im_uid_status."+this.cid);return null===e?l:e},set:function(e){c("_im_uid_status."+this.cid,e)}},{key:"uid",get:function(){return d("_im_uid."+this.cid)},set:function(e){var t="_im_uid."+this.cid;e?c(t,e):p(t)}},{key:"processIMUIDRequest",value:function(e,t){var i=this;t||(t=Date.now());var o=e.callbackTimeout,n=void 0===o?1e3:o,r=e.callback,u=e.loopbacks;M.extendExpireToVid();var s=M.vid,a=s===I;if(a)r({uid:"",vid:"",optouted:a,status:m,loopbacks:u});else{var d=this.uidExpireTime,c=this.cid,p=this.uid,b=this.uidLoadStatus,x=Date.now();p&&"number"==typeof d&&x>=d&&(b=h);var k=e.SYNC_URL||"https://audiencedata.im-apps.net/imuid/get";switch(k+="?cid="+c+"&vid="+s,b){default:case l:this.uidLoadStatus=v,this.uidExpireTime=x+18e5,f(k,(function(e){var t=e.uid;i.uid=t,i.uidLoadStatus=m,r({uid:t,vid:s,optouted:!1,status:m,loopbacks:u})}),{withCredentials:!0,timeout:n,onTimeout:function(){i.uidLoadStatus=l,r({uid:"",vid:"",optouted:!1,status:g,loopbacks:u})}});break;case v:if(x>=t+n)return this.uidLoadStatus=l,void r({uid:"",vid:"",optouted:!1,status:g,loopbacks:u});setTimeout((function(){i.processIMUIDRequest(e,t)}),9);break;case m:r({uid:this.uid||"",vid:s,optouted:a,status:m,loopbacks:u});break;case h:this.uidLoadStatus=y,this.uidExpireTime=x+18e5,f(k,(function(e){var t=e.uid;i.uid=t,i.uidLoadStatus=m}),{withCredentials:!0}),r({uid:this.uid||"",vid:s,optouted:!1,status:m,loopbacks:u});break;case y:r({uid:this.uid||"",vid:s,optouted:!1,status:m,loopbacks:u})}}}}]),t}(),D=window.IMUID;D||(D=new M);var T=window.IMUIDRequest;(T instanceof Array||!T)&&(window.IMUIDRequest={push:function(e){D.run(e)}}),T instanceof Array&&T.forEach((function(e){D.run(e)}));var E=D}(),o=o.IMUID}()}));